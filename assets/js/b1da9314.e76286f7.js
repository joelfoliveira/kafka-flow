"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6598],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>k});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var u=n.createContext({}),i=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},d=function(e){var t=i(e.components);return n.createElement(u.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=i(r),k=o,m=p["".concat(u,".").concat(k)]||p[k]||l[k]||a;return r?n.createElement(m,s(s({ref:t},d),{},{components:r})):n.createElement(m,s({ref:t},d))}));function k(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,s=new Array(a);s[0]=p;var c={};for(var u in t)hasOwnProperty.call(t,u)&&(c[u]=t[u]);c.originalType=e,c.mdxType="string"==typeof e?e:o,s[1]=c;for(var i=2;i<a;i++)s[i]=r[i];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}p.displayName="MDXCreateElement"},25073:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>l,frontMatter:()=>a,metadata:()=>c,toc:()=>i});var n=r(87462),o=(r(67294),r(3905));const a={sidebar_position:2},s="Producers",c={unversionedId:"guides/producers",id:"guides/producers",title:"Producers",description:"In this section, we will learn how to add and configure a Producer on KafkaFlow.",source:"@site/docs/guides/producers.md",sourceDirName:"guides",slug:"/guides/producers",permalink:"/kafkaflow/docs/guides/producers",draft:!1,editUrl:"https://github.com/farfetch/kafkaflow/tree/master/website/docs/guides/producers.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Configuration",permalink:"/kafkaflow/docs/guides/configuration"},next:{title:"Consumers",permalink:"/kafkaflow/docs/category/consumers"}},u={},i=[{value:"Name-based producers",id:"name-based-producers",level:2},{value:"Type-based producers",id:"type-based-producers",level:2},{value:"How to produce a message to a given topic",id:"how-to-produce-a-message-to-a-given-topic",level:2},{value:"How to produce a message without Message Key",id:"how-to-produce-a-message-without-message-key",level:2},{value:"How to configure ACKS when publishing a message",id:"how-to-configure-acks-when-publishing-a-message",level:2},{value:"How to customize compression",id:"how-to-customize-compression",level:2}],d={toc:i};function l(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"producers"},"Producers"),(0,o.kt)("p",null,"In this section, we will learn how to add and configure a Producer on KafkaFlow."),(0,o.kt)("p",null,"To produce messages using KafkaFlow, Producers need to be configured in the application ",(0,o.kt)("a",{parentName:"p",href:"configuration"},"configuration"),". "),(0,o.kt)("p",null,"The producers also support ",(0,o.kt)("a",{parentName:"p",href:"middlewares"},"Middlewares"),". "),(0,o.kt)("p",null,"You have two ways to configure the producers: "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#named-producers"},"Name-based producer")," "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#type-based-producers"},"Type-based producer"))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"It's highly recommended to read ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/confluentinc/confluent-kafka-dotnet/wiki/Producer"},"Confluent Producer documentation")," for better practices when producing messages.")),(0,o.kt)("h2",{id:"name-based-producers"},"Name-based producers"),(0,o.kt)("p",null,"Uses a name to bind the configuration to the producer instance.\nUse the name as a key to access the Producer when you want to produce a message."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'using KafkaFlow;\nusing KafkaFlow.Producers;\nusing Microsoft.Extensions.DependencyInjection;\n\nservices.AddKafka(kafka => kafka\n    .AddCluster(cluster => cluster\n        .WithBrokers(new[] { "localhost:9092" })\n        .AddProducer(\n            "product-events", //the producer name\n            producer => \n                producer\n        )\n    )\n);\n\npublic class ProductService : IProductService\n{\n    private readonly IProducerAccessor _producers;\n\n    public ProductService(IProducerAccessor producers)\n    {\n        _producers = producers;\n    }\n\n    public async Task CreateProduct(Product product) =>\n        await _producers["product-events"]\n            .ProduceAsync(product.Id.ToString(), product);     \n}\n')),(0,o.kt)("h2",{id:"type-based-producers"},"Type-based producers"),(0,o.kt)("p",null,"Uses a class to bind the configuration to the producer instance, this is commonly used when you create a producer class to decouple the framework from your service classes. "),(0,o.kt)("p",null,"For example, if you have a ",(0,o.kt)("inlineCode",{parentName:"p"},"ProductEventsProducer")," in your app, you can use this class when configuring the producer to bind the configuration with the instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"IMessageProducer<ProductEventsProducer>"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'using KafkaFlow;\nusing KafkaFlow.Producers;\nusing Microsoft.Extensions.DependencyInjection;\n\nvar services = new ServiceCollection();\n\nservices.AddKafka(kafka => kafka\n    .AddCluster(cluster => cluster\n        .WithBrokers(new[] { "localhost:9092" })\n        .AddProducer<ProductEventsProducer>(\n            producer => \n                producer\n                ...\n            )\n    )\n);\n\npublic class ProductEventsProducer : IProductEventsProducer\n{\n    private readonly IMessageProducer<ProductEventsProducer> _producer;\n\n    public ProductEventsProducer(IMessageProducer<ProductEventsProducer> producer)\n    {\n        _producer = producer;\n    }\n\n    public Task ProduceAsync(Product product) =>\n        _producer\n            .ProduceAsync(product.Id.ToString(), product);\n}\n')),(0,o.kt)("h2",{id:"how-to-produce-a-message-to-a-given-topic"},"How to produce a message to a given topic"),(0,o.kt)("p",null,"There are two ways to specify the destination Topic of a message."),(0,o.kt)("p",null,"You can specify it as the first argument when the Produce method is invoked, as shown in the following example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'await _producers["product-events"]\n    .ProduceAsync("products-topic", product.Id.ToString(), product);\n')),(0,o.kt)("p",null,"You can also set the Default Topic that a Producer should produce to.\nYou can do that, on the producer configuration."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'using KafkaFlow;\nusing KafkaFlow.Producers;\nusing Microsoft.Extensions.DependencyInjection;\n\nservices.AddKafka(kafka => kafka\n    .AddCluster(cluster => cluster\n        .WithBrokers(new[] { "localhost:9092" })\n        .AddProducer(\n            "product-events",\n            producer => \n                producer\n                    .DefaultTopic("products-topic")\n        )\n    )\n);\n')),(0,o.kt)("h2",{id:"how-to-produce-a-message-without-message-key"},"How to produce a message without Message Key"),(0,o.kt)("p",null,"You can send the message key argument as ",(0,o.kt)("inlineCode",{parentName:"p"},"null")," when the Produce method is invoked, as shown in the following example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"await producer.ProduceAsync(null, product);\n")),(0,o.kt)("h2",{id:"how-to-configure-acks-when-publishing-a-message"},"How to configure ACKS when publishing a message"),(0,o.kt)("p",null,"An Ack is an acknowledgment that the producer receives from the broker to ensure that the message has been successfully committed."),(0,o.kt)("p",null,"The following table establishes the mapping between KafkaFlow and Kafka. You can find ",(0,o.kt)("a",{parentName:"p",href:"https://docs.confluent.io/platform/current/installation/configuration/producer-configs.html#producerconfigs_acks"},"here")," the meaning of each of those values."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"KafkaFlow"),(0,o.kt)("th",{parentName:"tr",align:null},"Kafka"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Acks.None"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"acks=0"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Acks.Leader"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"acks=1"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Acks.All"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"acks=all"))))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'using KafkaFlow;\nusing KafkaFlow.Producers;\nusing Microsoft.Extensions.DependencyInjection;\n\nservices.AddKafka(kafka => kafka\n    .AddCluster(cluster => cluster\n        .WithBrokers(new[] { "localhost:9092" })\n        .AddProducer(\n            "product-events",\n            producer => \n                producer\n                    .WithAcks(Acks.Leader)\n        )\n    )\n);\n')),(0,o.kt)("h2",{id:"how-to-customize-compression"},"How to customize compression"),(0,o.kt)("p",null,"You can find more information in the ",(0,o.kt)("a",{parentName:"p",href:"compression"},"Compression guide"),"."))}l.isMDXComponent=!0}}]);